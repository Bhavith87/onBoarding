<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HR Onboarding Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }

    .header-banner {
      background-color: #2c3e50;
      color: white;
      padding: 25px 0;
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .dashboard-card {
      max-width: 1000px;
      margin: auto;
      margin-top: 40px;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .cards {
      display: flex;
      justify-content: space-around;
      margin: 20px auto;
      padding: 30px;
      max-width: 1000px;
    }

    .card h5 {
      margin-bottom: 10px;
    }

    .filter-section {
      max-width: 1000px;
      margin: 20px auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-section input,
    .filter-section select {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #000;
      margin-top: 10px;
      
    }
  </style>
</head>

<body>
  <div class="container mt-4">
    <h2 class="header-banner">HR Onboarding Dashboard</h2>

    <!-- Filter Section -->
    <div class="filter-section">
      <input type="text" id="searchInput" placeholder="Search by employee name..." style="width: 350px;" />
      <div>
        <label><strong>Filter:</strong></label>
        <select id="statusFilter" style="margin-right: 30px;">
          <option value="">All</option>
          <option value="Pending">Pending</option>
          <option value="Completed">Completed</option>
          <option value="InCompleted">InCompleted</option>
        </select>
        
        <button class="btn btn-danger " onclick="clearAll()">Clear All Records</button>
       </div>
    </div>

    <!-- Status Cards -->
    <div class="cards mt-4">
      <div class="card text-center" style="width: 200px;">
        <h5 class="m-2">Total Employee</h5>
        <p id="totalCount">0</p>
      </div>
      <div class="card text-center " style="width: 200px;">
        <h5 class="mt-2">Incomplete</h5>
        <p id="incompleteCount">0</p>
      </div>
      <div class="card text-center" style="width: 200px;">
        <h5 class="mt-2">Completed</h5>
        <p id="completedCount">0</p>
      </div>
      <div class="card text-center" style="width: 200px;">
        <h5 class="mt-2">Pending</h5>
        <p id="pendingCount">0</p>
      </div>
    </div>

    <!-- Table Card -->
    <div class="dashboard-card">
      <div class="table-responsive">
        <table class="table table-bordered" id="employeeTable">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="employeeTableBody"></tbody>
        </table>
      </div>

      <!-- Clear Button -->
      <div class="text-end">
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Employee Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBodyContent"></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
  const API_BASE_URL = "http://localhost:8080/api/onboarding";

  let employeeData = [];

  // Fetch all employees from API
  async function fetchEmployees() {
    try {
      const response = await fetch(`${API_BASE_URL}/all`);
      employeeData = await response.json();
      employeeData.forEach(emp => {
        if (!emp.status) emp.status = "Pending";
      });
      renderTable();
      updateCounts();
    } catch (error) {
      console.error("Error fetching employee data:", error);
    }
  }

  // Update counts
  function updateCounts() {
    document.getElementById('totalCount').textContent = employeeData.length;
    document.getElementById('pendingCount').textContent = employeeData.filter(e => e.status === "Pending").length;
    document.getElementById('completedCount').textContent = employeeData.filter(e => e.status === "Completed").length;
    document.getElementById('incompleteCount').textContent = employeeData.filter(e => e.status === "InCompleted").length;
  }

  // Render table based on filter
  function renderTable(filter = "", statusFilter = "") {
    const tbody = document.getElementById("employeeTableBody");
    tbody.innerHTML = "";

    const filtered = employeeData.filter(emp =>
      emp.name.toLowerCase().includes(filter.toLowerCase()) &&
      (statusFilter === "" || emp.status === statusFilter)
    );

    filtered.forEach((emp, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${emp.name}</td>
        <td>${emp.email}</td>
        <td>${emp.phone}</td>
        <td>
          <select class="form-select status-select" data-id="${emp.id}" ${emp.status !== 'Pending' ? 'disabled' : ''}>
            <option ${emp.status === 'Pending' ? 'selected' : ''}>Pending</option>
            <option ${emp.status === 'Completed' ? 'selected' : ''}>Completed</option>
            <option ${emp.status === 'InCompleted' ? 'selected' : ''}>InCompleted</option>
          </select>
        </td>
        <td><button class="btn btn-primary btn-sm" onclick="viewDetails(${index})">View Details</button></td>
      `;
      tbody.appendChild(row);
    });

    document.querySelectorAll('.status-select').forEach(select => {
      select.addEventListener('change', async function () {
        const id = this.getAttribute("data-id");
        const newStatus = this.value;
        await updateStatus(id, newStatus);
      });
    });

    updateCounts();
  }

  // Update employee status via API
  async function updateStatus(id, newStatus) {
    try {
      const employee = employeeData.find(e => e.id == id);
      if (!employee) return;

      employee.status = newStatus;

      const response = await fetch(`${API_BASE_URL}/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(employee)
      });

      if (response.ok) {
        alert("Status updated successfully!");
        fetchEmployees();
      } else {
        alert("Failed to update status.");
      }
    } catch (err) {
      console.error("Error updating status:", err);
    }
  }

  // View employee details in modal
  function viewDetails(index) {
    const emp = employeeData[index];
    let html = `<strong>Personal Details:</strong><br>
      <strong>Name:</strong> ${emp.name}<br>
      <strong>Email:</strong> ${emp.email}<br>
      <strong>Phone:</strong> ${emp.phone}<br>
      <strong>Date Of Birth:</strong> ${emp.doB}<br>
      <strong>Marital Status:</strong> ${emp.marital}<br>
      <strong>Aadhar Number:</strong> ${emp.aadhar}<br>
      <strong>PAN Number:</strong> ${emp.pan}<br>
      <strong>Alternate Phone:</strong> ${emp.phoneAl}<br>
      <strong>Gender:</strong> ${emp.gender}<br>
      <strong>Blood Group:</strong> ${emp.bloodGroup}<br>
      <strong>Guardian Name:</strong> ${emp.gName}<br>
      <strong>Guardian Phone:</strong> ${emp.gPnum}<br><hr>`;

    html += `<strong>Education:</strong><ul>`;
    emp.education?.forEach(e => {
      html += `<li>${e.degree}, ${e.collegeName}, ${e.stream}, ${e.yearOfPassing}, ${e.location}, ${e.aggregation}</li>`;
    });
    html += `</ul><hr>`;

    html += `<strong>Experience:</strong><ul>`;
    emp.experience?.forEach(e => {
      html += `<li>${e.companyName}, ${e.role}, ${e.years}, ${e.location}</li>`;
    });
    html += `</ul><hr>`;

    html += `<strong>Bank Details:</strong><br>
      <strong>Name:</strong> ${emp.bname}<br>
      <strong>Account:</strong> ${emp.bankAccount}<br>
      <strong>IFSC:</strong> ${emp.ifsc}<br>
      <strong>Branch:</strong> ${emp.branchName}<br><hr>`;

    html += `<strong>Current Address:</strong><br>
      <strong>Address:</strong> ${emp.cAddress}<br>
      <strong>Street:</strong> ${emp.cStreet}<br>
      <strong>City:</strong> ${emp.cCity}<br>
      <strong>State:</strong> ${emp.cState}<br>
      <strong>Country:</strong> ${emp.cCountry}<br><hr>`;

    html += `<strong>Permanent Address:</strong><br>
      <strong>Address:</strong> ${emp.pAddress}<br>
      <strong>Street:</strong> ${emp.pStreet}<br>
      <strong>City:</strong> ${emp.pCity}<br>
      <strong>State:</strong> ${emp.pState}<br>
      <strong>Country:</strong> ${emp.pCountry}<br>`;

    document.getElementById("modalBodyContent").innerHTML = html;
    new bootstrap.Modal(document.getElementById('detailsModal')).show();
  }

  // Clear All (optional feature)
 function clearAll() {
  if (confirm("Are you sure you want to delete all onboarding records?")) {
    fetch("http://localhost:8080/api/onboarding/clear", {
      method: "DELETE"
    })
    .then(res => {
      if (res.ok) {
        alert("All records deleted.");
        renderTable();
      } else {
        alert("Failed to delete records.");
      }
    })
    .catch(err => {
      console.error("Error:", err);
      alert("Error deleting records.");
    });
  }
}



  // Search & filter handlers
  document.getElementById('searchInput').addEventListener('input', e => {
    renderTable(e.target.value, document.getElementById('statusFilter').value);
  });

  document.getElementById('statusFilter').addEventListener('change', e => {
    renderTable(document.getElementById('searchInput').value, e.target.value);
  });

  // Initial load
  fetchEmployees();
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
